<!DOCTYPE html>



















































































<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width" />

<meta name="Description" content="When you want to make a connection to one of the Google APIs provided in the Google Play services library (such as Google+, Games, or Drive), you need to create an instance of GoogleApiClient (&quot;Google API Client&quot;). The Google API Client provides…">
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>Accessing Google Play Services APIs | Android Developers</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto+Condensed">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:light,regular,medium,thin,italic,mediumitalic,bold"
  title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var metaTags = ["oauth2.0","googleauthutil"];
  var devsite = false;
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5831155-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body class="gc-documentation 

google" itemscope itemtype="http://schema.org/Article">

<a name="top"></a>

  <!-- Header -->
  <div id="header-wrapper">
    <div id="header">
      <div class="wrap" id="header-wrap">
        <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png"
                srcset="../../assets/images/dac_logo@2x.png 2x"
                width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
            <a href="#" class="arrow-inactive">Quicknav</a>
            <a href="#" class="arrow-active">Quicknav</a>
          </div>
        </div>
        <ul class="nav-x col-9">
            <li class="design">
              <a href="../../design/index.html"
              zh-tw-lang="設計"
              zh-cn-lang="设计"
              ru-lang="Проектирование"
              ko-lang="디자인"
              ja-lang="設計"
              es-lang="Diseñar"
              >Design</a></li>
            <li class="develop"><a href="../../develop/index.html"
              zh-tw-lang="開發"
              zh-cn-lang="开发"
              ru-lang="Разработка"
              ko-lang="개발"
              ja-lang="開発"
              es-lang="Desarrollar"
              >Develop</a></li>
            <li class="distribute last"><a href="../../distribute/googleplay/index.html"
              zh-tw-lang="發佈"
              zh-cn-lang="分发"
              ru-lang="Распространение"
              ko-lang="배포"
              ja-lang="配布"
              es-lang="Distribuir"
              >Distribute</a></li>
        </ul>


        
        
<div class="menu-container">
  <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/" target="_googleplay">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>

      
      
      
      <br class="clearfix" />
    </div><!-- end 'mid' -->
    <div class="bottom"></div>
  </div><!-- end 'moremenu' -->

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
          onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
          onkeydown="return search_changed(event, true, '../../')"
          onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
      <a class="close hide">close</a>
      <div class="left"></div>
      <div class="right"></div>
    </div><!-- end search-inner -->
  </div><!-- end search-container -->

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
      <div class="child-card samples no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>
</div><!-- end menu-container (search and menu widget) -->



        <!-- Expanded quicknav -->
        <div id="quicknav" class="col-9">
          <ul>
            <li class="design">
              <ul>
                <li><a href="../../design/index.html">Get Started</a></li>
                <li><a href="../../design/style/index.html">Style</a></li>
                <li><a href="../../design/patterns/index.html">Patterns</a></li>
                <li><a href="../../design/building-blocks/index.html">Building Blocks</a></li>
                <li><a href="../../design/downloads/index.html">Downloads</a></li>
                <li><a href="../../design/videos/index.html">Videos</a></li>
              </ul>
            </li>
            <li class="develop">
              <ul>
                <li><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"
                  >Training</a></li>
                <li><a href="../../guide/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"
                  >API Guides</a></li>
                <li><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"
                  >Reference</a></li>
                <li><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >Tools</a>
                  <ul><li><a href="../../sdk/index.html">Get the SDK</a></li></ul>
                </li>
                <li><a href="../../google/index.html">Google Services</a>
                </li>
                
              </ul>
            </li>
            <li class="distribute last">
              <ul>
                <li><a href="../../distribute/googleplay/index.html">Google Play</a></li>
                <li><a href="../../distribute/essentials/index.html">Essentials</a></li>
                <li><a href="../../distribute/users/index.html">Get Users</a></li>
                <li><a href="../../distribute/engage/index.html">Engage &amp; Retain</a></li>
                <li><a href="../../distribute/monetize/index.html">Monetize</a></li>
                <li><a href="../../distribute/tools/index.html">Tools &amp; Reference</a></li>
                <li><a href="../../distribute/stories/index.html">Developer Stories</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /Expanded quicknav -->
      </div><!-- end header-wrap.wrap -->
    </div><!-- end header -->

  
    <!-- Secondary x-nav -->
    <div id="nav-x">
        <div class="wrap">
            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"
                  >Training</a></li>
                <li class="guide"><a href="../../guide/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"
                  >API Guides</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"
                  >Reference</a></li>
                <li class="tools"><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >Tools</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google Services</a>
                </li>
                
            </ul>
        </div>
    </div>
    <!-- /Sendondary x-nav -->

  

    <div id="searchResults" class="wrap" style="display:none;">
      <h2 id="searchTitle">Results</h2>
      <div id="leftSearchControl" class="search-control">Loading...</div>
    </div>
  </div> <!--end header-wrapper -->

  <div id="sticky-header">
    <div>
      <a class="logo" href="#top"></a>
      <a class="top" href="#top"></a>
      <ul class="breadcrumb">
        
        <li class="current">Accessing Google Play Services APIs</li>
      </ul>
    </div>
  </div>




  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">



<ul id="nav">

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/index.html">
          <span class="en">Overview</span>
      </a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/games.html">
          <span class="en">Games</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/location.html">
          <span class="en">Location</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/plus.html">
          <span class="en">Google+</span>
                </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/maps.html">
          <span class="en">Maps</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/drive.html">
          <span class="en">Drive</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/cast.html">
          <span class="en">Cast</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play-services/ads.html">
      <span class="en">Ads</span></a>
    </div>
    <ul>
      <li><a href="../../google/play-services/id.html">
          <span class="en">Advertising ID</span></a>
      </li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/wallet.html">
          <span class="en">Wallet</span>
      </a></div>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play-services/index.html">
      <span class="en">Google Play Services</span></a>
    </div>
    <ul>
      <li><a href="../../google/play-services/setup.html">
          <span class="en">Setup</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../google/auth/api-client.html">
          <span class="en">Accessing Google Play Services APIs</span></a>
        </div>
        <ul>
          <li>
            <a href="../../google/auth/http-auth.html">
              <span class="en">Authorizing with Google for REST APIs</span>
            </a>
          </li>
        </ul>
      </li>
      <li id="gms-tree-list" class="nav-section">
        <div class="nav-section-header">
          <a href="../../reference/gms-packages.html">
            <span class="en">Reference</span>
          </a>
        <div>
      </li>
    </ul>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play/billing/index.html">
      <span class="en">Google Play In-app Billing</span></a>
    </div>
    <ul>
      <li><a href="../../google/play/billing/billing_overview.html">
              <span class="en">Overview</span></a>
      </li>
      <li class="nav-section"><div class="nav-section-header"><a href="../../google/play/billing/api.html">
              <span class="en">Version 3 API</span></a></div>
              <ul>
              <li><a href="../../google/play/billing/billing_integrate.html">
              <span class="en">Implementing the API</span></a></li>
              <li><a href="../../google/play/billing/billing_reference.html">
              <span class="en">Reference</span></a></li>
              </ul>
      </li>
      <li class="nav-section"><div class="nav-section-header"><a href="../../google/play/billing/v2/api.html">
              <span class="en">Version 2 API</span></a></div>
              <ul>
              <li><a href="../../google/play/billing/v2/billing_integrate.html">
              <span class="en">Implementing the API</span></a></li>
              <li><a href="../../google/play/billing/v2/billing_subscriptions.html">
              <span class="en">Subscriptions</span></a></li>
              <li><a href="../../google/play/billing/v2/billing_reference.html">
              <span class="en">Reference</span></a></li>
              </ul>
      </li>
      <li><a href="../../google/play/billing/billing_subscriptions.html">
              <span class="en">Subscriptions</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_best_practices.html">
              <span class="en">Security and Design</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_testing.html">
              <span class="en">Testing In-app Billing</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_admin.html">
              <span class="en">Administering In-app Billing</span></a>
      </li>
      <li><a href="../../google/play/billing/gp-purchase-status-api.html">
              <span class="en">Purchase Status API</span></a>
      </li>
      <li><a href="../../google/play/billing/versions.html">
              <span class="en">Version Notes</span></a>
      </li>
    </ul>
  </li>



   <li class="nav-section">
      <div class="nav-section-header"><a href="../../google/gcm/index.html">
        <span class="en">Google Cloud Messaging</span></a>
      </div>
      <ul>
        <li><a href="../../google/gcm/gcm.html">
            <span class="en">Overview</span></a>
        </li>
        <li><a href="../../google/gcm/gs.html">
            <span class="en">Getting Started</span></a>
        </li>
        <li><a href="../../google/gcm/client.html">
            <span class="en">Implementing GCM Client</span></a>
        </li>
        <li class="nav-section"><div class="nav-section-header"><a href="../../google/gcm/server.html">
              <span class="en">Implementing GCM Server</span></a></div>
              <ul>
              <li><a href="../../google/gcm/ccs.html">
              <span class="en">CCS (XMPP)</span></a></li>
              <li><a href="../../google/gcm/http.html">
              <span class="en">HTTP</span></a></li>
              </ul>
        </li>
        <li><a href="../../google/gcm/notifications.html">
              <span class="en">User Notifications</span></a>
        </li>
        <li><a href="../../google/gcm/adv.html">
            <span class="en">Advanced Topics</span></a>
        </li>
        <li><a href="../../google/gcm/c2dm.html">
            <span class="en">Migration</span></a>
        </li>
        <li id="gcm-tree-list" class="nav-section">
          <div class="nav-section-header">
            <a href="../../reference/gcm-packages.html">
              <span class="en">Reference</span>
            </a>
          <div>
        </li>
      </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play/dist.html">
      <span class="en">Google Play Distribution</span></a>
    </div>
    <ul>
      <li><a href="../../google/play/filters.html">
          <span class="en">Filters on Google Play</span></a>
      </li>

      <li><a href="../../google/play/publishing/multiple-apks.html">
          <span class="en">Multiple APK Support</span></a>
      </li>
      <li><a href="../../google/play/expansion-files.html">
          <span class="en">APK Expansion Files</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../google/play/licensing/index.html">
          <span class="en">Application Licensing</span></a>
        </div>
        <ul>
          <li><a href="../../google/play/licensing/overview.html">
              <span class="en">Licensing Overview</span></a>
          </li>
          <li><a href="../../google/play/licensing/setting-up.html">
              <span class="en">Setting Up for Licensing</span></a>
          </li>
          <li><a href="../../google/play/licensing/adding-licensing.html">
              <span class="en">Adding Licensing to Your App</span></a>
          </li>
          <li><a href="../../google/play/licensing/licensing-reference.html">
              <span class="en">Licensing Reference</span></a>
          </li>
        </ul>
      </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/backup/index.html">
      Android Backup Service</a>
    </div>
    <ul>
      <li><a href="../../google/backup/signup.html">
          Register</a>
      </li>
    </ul>
  </li>

  </ul>

</li>



</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
      <script type="text/javascript">
       showGoogleRefTree();
    
      </script>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >




  
    
      
        <h1 itemprop="name" >Accessing Google Play Services APIs</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
  <div id="qv">

<h2>In this document</h2>
<ol>
  <li><a href="#Starting">Start a Connection</a>
    <ol>
      <li><a href="#HandlingFailures">Handle connection failures</a></li>
      <li><a href="#MaintainingState">Maintain state while resolving an error</a></li>
    </ol>
  </li>
  <li><a href="#Communicating">Communicate with Google Services</a>
    <ol>
      <li><a href="#Async">Using asynchronous calls</a></li>
      <li><a href="#Sync">Using synchronous calls</a></li>
    </ol>
  </li>
</ol>
</div>
</div>


<p>When you want to make a connection to one of the Google APIs provided in the Google Play services
library (such as Google+, Games, or Drive), you need to create an instance of <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> ("Google API Client"). The Google API Client provides a common entry point to all
the Google Play services and manages the network connection between the user's device and each
Google service.</p>

<div class="sidebox" style="clear:right;width:190px">
<h2>Connecting to REST APIs</h2>
<p>If the Google API you want to use is not included in the Google Play services library, you can
connect using the appropriate REST API, but you must obtain an OAuth 2.0 token. For more
information, read <a href="../../google/auth/http-auth.html">Authorizing with Google
for REST APIs</a>.</p>
</div>

<p>This guide shows how you can use Google API Client to:</p>
<ul>
<li>Connect to one or more Google Play services asynchronously and handle failures.</li>
<li>Perform synchronous and asynchronous API calls to any of the Google Play services.</li>
</ul>

<p class="note">
<strong>Note:</strong> If you have an existing app that connects to Google Play services with a
subclass of <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesClient.html"><code>GooglePlayServicesClient</code></a>, you should migrate to <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> as soon as possible.</p>


<img src="../../images/google/GoogleApiClient@2x.png" width="464px" alt="" />
<p class="img-caption">
<strong>Figure 1.</strong> An illustration showing how the Google API Client provides an
interface for connecting and making calls to any of the available Google Play services such as
Google Play Games and Google Drive.</p>



<p>To get started, you must first install the Google Play services library (revision 15 or higher) for
your Android SDK. If you haven't done so already, follow the instructions in <a
href="../../google/play-services/setup.html">Set Up Google
Play Services SDK</a>.</p>




<h2 id="Starting">Start a Connection</h2>

<p>Once your project is linked to the Google Play services library, create an instance of <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> using the <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.Builder.html"><code>GoogleApiClient.Builder</code></a> APIs in your activity's <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code> method. The <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.Builder.html"><code>GoogleApiClient.Builder</code></a> class
provides methods that allow you to specify the Google APIs you want to use and your desired OAuth
2.0 scopes. For example, here's a <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> instance that connects with the Google
Drive service:</p>
<pre>
GoogleApiClient mGoogleApiClient = new GoogleApiClient.Builder(this)
    .addApi(Drive.API)
    .addScope(Drive.SCOPE_FILE)
    .build();
</pre>

<p>You can add multiple APIs and multiple scopes to the same <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> by appending
additional calls to
<a href="../../reference/com/google/android/gms/common/api/GoogleApiClient.Builder.html#addApi(com.google.android.gms.common.api.Api)"
><code>addApi()</code></a> and
<a href="../../reference/com/google/android/gms/common/api/GoogleApiClient.Builder.html#addScope(com.google.android.gms.common.api.Scope)"
><code>addScope()</code></a>.</p>

<p>However, before you can begin a connection by calling <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a> on the <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a>, you must specify an implementation for the callback interfaces, <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.ConnectionCallbacks.html"
><code>ConnectionCallbacks</code></a> and <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.OnConnectionFailedListener.html"
><code>OnConnectionFailedListener</code></a>. These interfaces receive callbacks in
response to the asynchronous <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a> method when the connection to Google Play services
succeeds, fails, or becomes suspended.</p>

<p>For example, here's an activity that implements the callback interfaces and adds them to the Google
API Client:</p>

<pre>
import gms.common.api.*;
import gms.drive.*;
import android.support.v4.app.FragmentActivity;

public class MyActivity extends FragmentActivity
        implements ConnectionCallbacks, OnConnectionFailedListener {
    private GoogleApiClient mGoogleApiClient;

    &#64;Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        // Create a GoogleApiClient instance
        mGoogleApiClient = new GoogleApiClient.Builder(this)
                .addApi(Drive.API)
                .addScope(Drive.SCOPE_FILE)
                .addConnectionCallbacks(this)
                .addOnConnectionFailedListener(this)
                .build();
        ...
    }

    &#64;Override
    public void onConnected(Bundle connectionHint) {
        // Connected to Google Play services!
        // The good stuff goes here.
    }

    &#64;Override
    public void onConnectionSuspended(int cause) {
        // The connection has been interrupted.
        // Disable any UI components that depend on Google APIs
        // until onConnected() is called.
    }

    &#64;Override
    public void onConnectionFailed(ConnectionResult result) {
        // This callback is important for handling errors that
        // may occur while attempting to connect with Google.
        //
        // More about this in the next section.
        ...
    }
}
</pre>

<p>With the callback interfaces defined, you're ready to call <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a>. To gracefully manage
the lifecycle of the connection, you should call <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a> during the activity's <code><a href="../../reference/android/app/Activity.html#onStart()">onStart()</a></code> (unless you want to connect later), then call <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#disconnect()"
><code>disconnect()</code></a> during the <code><a href="../../reference/android/app/Activity.html#onStop()">onStop()</a></code> method. For example:</p>
<pre>
    &#64;Override
    protected void onStart() {
        super.onStart();
        if (!mResolvingError) {  // more about this later
            mGoogleApiClient.connect();
        }
    }

    &#64;Override
    protected void onStop() {
        mGoogleApiClient.disconnect();
        super.onStop();
    }
</pre>

<p>However, if you run this code, there's a good chance it will fail and your app will receive a call
to <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesClient.OnConnectionFailedListener.html#onConnectionFailed(com.google.android.gms.common.ConnectionResult)"
><code>onConnectionFailed()</code></a> with the <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#SIGN_IN_REQUIRED"
><code>SIGN_IN_REQUIRED</code></a> error because the user account
has not been specified. The next section shows how to handle this error and others.</p>




<h3 id="HandlingFailures">Handle connection failures</h3>

<p>When you receive a call to the <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesClient.OnConnectionFailedListener.html#onConnectionFailed(com.google.android.gms.common.ConnectionResult)"
><code>onConnectionFailed()</code></a> callback, you should call <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#hasResolution()"
><code>hasResolution()</code></a> on the provided <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html"
><code>ConnectionResult</code></a> object. If it returns true, you can
request the user take immediate action to resolve the error by calling <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#startResolutionForResult(android.app.Activity, int)"><code>startResolutionForResult()</code></a> on the <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html"
><code>ConnectionResult</code></a> object. The <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#startResolutionForResult(android.app.Activity, int)"
><code>startResolutionForResult()</code></a> behaves the same as <code><a href="../../reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> and launches the
appropriate activity for the user
to resolve the error (such as an activity to select an account).</p>

<p>If <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#hasResolution()"
><code>hasResolution()</code></a> returns false, you should instead call <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesUtil.html#getErrorDialog(int, android.app.Activity, int)"
><code>GooglePlayServicesUtil.getErrorDialog()</code></a>, passing it the error code. This returns a <code><a href="../../reference/android/app/Dialog.html">Dialog</a></code> provided by Google Play services that's appropriate for the given error. The
dialog may simply provide a message explaining the error, but it may also provide an action to
launch an activity that can resolve the error (such as when the user needs to install a newer
version of Google Play services).</p>

<p>For example, your <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesClient.OnConnectionFailedListener.html#onConnectionFailed(com.google.android.gms.common.ConnectionResult)"
><code>onConnectionFailed()</code></a> callback method should now look like this:</p>

<pre>
public class MyActivity extends FragmentActivity
        implements ConnectionCallbacks, OnConnectionFailedListener {

    // Request code to use when launching the resolution activity
    private static final int REQUEST_RESOLVE_ERROR = 1001;
    // Unique tag for the error dialog fragment
    private static final String DIALOG_ERROR = "dialog_error";
    // Bool to track whether the app is already resolving an error
    private boolean mResolvingError = false;

    ...

    &#64;Override
    public void onConnectionFailed(ConnectionResult result) {
        if (mResolvingError) {
            // Already attempting to resolve an error.
            return;
        } else if (result.hasResolution()) {
            try {
                mResolvingError = true;
                result.startResolutionForResult(this, REQUEST_RESOLVE_ERROR);
            } catch (SendIntentException e) {
                // There was an error with the resolution intent. Try again.
                mGoogleApiClient.connect();
            }
        } else {
            // Show dialog using GooglePlayServicesUtil.getErrorDialog()
            showErrorDialog(result.getErrorCode());
            mResolvingError = true;
        }
    }

    // The rest of this code is all about building the error dialog

    /* Creates a dialog for an error message */
    private void showErrorDialog(int errorCode) {
        // Create a fragment for the error dialog
        ErrorDialogFragment dialogFragment = new ErrorDialogFragment();
        // Pass the error that should be displayed
        Bundle args = new Bundle();
        args.putInt(DIALOG_ERROR, errorCode);
        dialogFragment.setArguments(args);
        dialogFragment.show(getSupportFragmentManager(), "errordialog");
    }

    /* Called from ErrorDialogFragment when the dialog is dismissed. */
    public void onDialogDismissed() {
        mResolvingError = false;
    }

    /* A fragment to display an error dialog */
    public static class ErrorDialogFragment extends DialogFragment {
        public ErrorDialogFragment() { }

        &#64;Override
        public Dialog onCreateDialog(Bundle savedInstanceState) {
            // Get the error code and retrieve the appropriate dialog
            int errorCode = this.getArguments().getInt(DIALOG_ERROR);
            return GooglePlayServicesUtil.getErrorDialog(errorCode,
                    this.getActivity(), REQUEST_RESOLVE_ERROR);
        }

        &#64;Override
        public void onDismiss(DialogInterface dialog) {
            ((MainActivity)getActivity()).onDialogDismissed();
        }
    }
}
</pre>

<p>Once the user completes the resolution provided by <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#startResolutionForResult(android.app.Activity, int)"
><code>startResolutionForResult()</code></a> or <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesUtil.html#getErrorDialog(int, android.app.Activity, int)"
><code>GooglePlayServicesUtil.getErrorDialog()</code></a>, your activity receives the <code><a href="../../reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">onActivityResult()</a></code> callback with the <code><a href="../../reference/android/app/Activity.html#RESULT_OK">RESULT_OK</a></code>
result code. You can then call <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a> again. For example:</p>

<pre>
&#64;Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == REQUEST_RESOLVE_ERROR) {
        mResolvingError = false;
        if (resultCode == RESULT_OK) {
            // Make sure the app is not already connected or attempting to connect
            if (!mGoogleApiClient.isConnecting() &&
                    !mGoogleApiClient.isConnected()) {
                mGoogleApiClient.connect();
            }
        }
    }
}
</pre>

<p>In the above code, you probably noticed the boolean, <code>mResolvingError</code>. This keeps track of
the app state while the user is resolving the error to avoid repetitive attempts to resolve the
same error. For instance, while the account picker dialog is showing to resolve the <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#SIGN_IN_REQUIRED"
><code>SIGN_IN_REQUIRED</code></a> error, the user may rotate the screen. This recreates your activity and causes
your <code><a href="../../reference/android/app/Activity.html#onStart()">onStart()</a></code> method to be called again, which then calls <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html#connect()"
><code>connect()</code></a> again. This results in another call to <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#startResolutionForResult(android.app.Activity, int)"
><code>startResolutionForResult()</code></a>, which
creates another account picker dialog in front of the existing one.</p>

<p>This boolean is effective only
if retained across activity instances, though. The next section explains further.</p>



<h3 id="MaintainingState">Maintain state while resolving an error</h3>

<p>To avoid executing the code in <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesClient.OnConnectionFailedListener.html#onConnectionFailed(com.google.android.gms.common.ConnectionResult)"
><code>onConnectionFailed()</code></a> while a previous attempt to resolve an
error is ongoing, you need to retain a boolean that tracks whether your app is already attempting
to resolve an error.</p>

<p>As shown in the code above, you should set a boolean to <code>true</code> each time you call <a
href="../../reference/com/google/android/gms/common/ConnectionResult.html#startResolutionForResult(android.app.Activity, int)"
><code>startResolutionForResult()</code></a> or display the dialog from <a
href="../../reference/com/google/android/gms/common/GooglePlayServicesUtil.html#getErrorDialog(int, android.app.Activity, int)"
><code>GooglePlayServicesUtil.getErrorDialog()</code></a>. Then when you
receive <code><a href="../../reference/android/app/Activity.html#RESULT_OK">RESULT_OK</a></code> in the <code><a href="../../reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">onActivityResult()</a></code> callback, set the boolean to <code>false</code>.</p>

<p>To keep track of the boolean across activity restarts (such as when the user rotates the screen),
save the boolean in the activity's saved instance data using <code><a href="../../reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code>:</p>

<pre>
private static final String STATE_RESOLVING_ERROR = "resolving_error";

&#64;Override
protected void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    outState.putBoolean(STATE_RESOLVING_ERROR, mResolvingError);
}
</pre>

<p>Then recover the saved state during <code><a href="../../reference/android/app/Activity.html#onCreate(android.os.Bundle)">onCreate()</a></code>:</p>

<pre>
&#64;Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    ...
    mResolvingError = savedInstanceState != null
            && savedInstanceState.getBoolean(STATE_RESOLVING_ERROR, false);
}
</pre>

<p>Now you're ready to safely run your app and connect to Google Play services.
How you can perform read and write requests to any of the Google Play services
using <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> is discussed in the next section.</p>

<p>For more information about each services's APIs available once you're connected,
consult the corresponding documentation, such as for
<a href="../../google/play-services/games.html">Google Play Games</a> or
<a href="../../google/play-services/drive.html">Google Drive</a>.
</p>




<h2 id="Communicating">Communicate with Google Services</h2>

<p>Once connected, your client can make read and write calls using the service-specific APIs for which
your app is authorized, as specified by the APIs and scopes you added to your <a
href="../../reference/com/google/android/gms/common/api/GoogleApiClient.html"><code>GoogleApiClient</code></a> instance.</p>

<p class="note">
<strong>Note:</strong> Before making calls to specific Google services, you may first need to
register your app in the Google Developer Console. For specific instructions, refer to the
appropriate getting started guide for the API you're using, such as <a href=
"https://developers.google.com/drive/android/get-started">Google Drive</a> or <a href=
"https://developers.google.com/+/mobile/android/getting-started">Google+</a>.</p>

<p>When you perform a read or write request using Google API Client, the immediate result is returned
as a <a href="../../reference/com/google/android/gms/common/api/PendingResult.html"><code>PendingResult</code></a> object. This is an object representing the request, which hasn't yet
been delivered to the Google service.</p>

<p>For example, here's a request to read a file from Google Drive that provides a
<a href="../../reference/com/google/android/gms/common/api/PendingResult.html"><code>PendingResult</code></a> object:</p>

<pre>
Query query = new Query.Builder()
        .addFilter(Filters.eq(SearchableField.TITLE, filename));
PendingResult result = Drive.DriveApi.query(mGoogleApiClient, query);
</pre>

<p>Once you have the
<a href="../../reference/com/google/android/gms/common/api/PendingResult.html"><code>PendingResult</code></a>, you can continue by making the request either asynchronous
or synchronous.</p>


<h3 id="Async">Using asynchronous calls</h3>

<p>To make the request asynchronous, call <a
href="../../reference/com/google/android/gms/common/api/PendingResult.html#setResultCallback(com.google.android.gms.common.api.ResultCallback<R>)"
><code>setResultCallback()</code></a> on the
<a href="../../reference/com/google/android/gms/common/api/PendingResult.html"><code>PendingResult</code></a> and
provide an implementation of the <a
href="../../reference/com/google/android/gms/common/api/ResultCallback.html"
><code>ResultCallback</code></a> interface. For example, here's the request
executed asynchronously:</p>

<pre>
private void loadFile(String filename) {
    // Create a query for a specific filename in Drive.
    Query query = new Query.Builder()
            .addFilter(Filters.eq(SearchableField.TITLE, filename))
            .build();
    // Invoke the query asynchronously with a callback method
    Drive.DriveApi.query(mGoogleApiClient, query)
            .setResultCallback(new ResultCallback&lt;DriveApi.MetadataBufferResult>() {
        &#64;Override
        public void onResult(DriveApi.MetadataBufferResult result) {
            // Success! Handle the query result.
            ...
        }
    });
}
</pre>

<p>When your app receives a <a
href="../../reference/com/google/android/gms/common/api/Result.html"><code>Result</code></a>
object in the <a
href="../../reference/com/google/android/gms/common/api/ResultCallback.html#onResult(R)"
><code>onResult()</code></a> callback, it is delivered as an instance of the
appropriate subclass as specified by the API you're using, such as <a
href="../../reference/com/google/android/gms/drive/DriveApi.MetadataBufferResult.html"
><code>DriveApi.MetadataBufferResult</code></a>.</p>


<h3 id="Sync">Using synchronous calls</h3>

<p>If you want your code to execute in a strictly defined order, perhaps because the result of one
call is needed as an argument to another, you can make your request synchronous by calling <a
href="../../reference/com/google/android/gms/common/api/PendingResult.html#await()"
><code>await()</code></a> on the
<a href="../../reference/com/google/android/gms/common/api/PendingResult.html"><code>PendingResult</code></a>. This blocks the thread and returns the <a
href="../../reference/com/google/android/gms/common/api/Result.html"><code>Result</code></a> object
when the request completes, which is delivered as an instance of the
appropriate subclass as specified by the API you're using, such as <a
href="../../reference/com/google/android/gms/drive/DriveApi.MetadataBufferResult.html"
><code>DriveApi.MetadataBufferResult</code></a>.</p>

<p>Because calling <a
href="../../reference/com/google/android/gms/common/api/PendingResult.html#await()"
><code>await()</code></a> blocks the thread until the result arrives, it's important that you
never perform this call on the UI thread. So, if you want to perform synchronous requests to a
Google Play service, you should create a new thread, such as with <code><a href="../../reference/android/os/AsyncTask.html">AsyncTask</a></code> in
which to perform the request. For example, here's how to perform the same file request to Google
Drive as a synchronous call:</p>

<pre>
private void loadFile(String filename) {
    new GetFileTask().execute(filename);
}

private class GetFileTask extends AsyncTask&lt;String, Void, Void> {
    protected void doInBackground(String filename) {
        Query query = new Query.Builder()
                .addFilter(Filters.eq(SearchableField.TITLE, filename))
                .build();
        // Invoke the query synchronously
        DriveApi.MetadataBufferResult result =
                Drive.DriveApi.query(mGoogleApiClient, query).await();

        // Continue doing other stuff synchronously
        ...
    }
}
</pre>

<p class="note">
<strong>Tip:</strong> You can also enqueue read requests while not connected to Google Play
services. For example, execute a method to read a file from Google Drive regardless of whether your
Google API Client is connected yet. Then once a connection is established, the read requests
execute and you'll receive the results. Any write requests, however, will generate an error if you
call them while your Google API Client is not connected.</p>


    </div>

      <div class="content-footer layout-content-row"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-9" style="padding-top:4px">
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>

      
      

  </div> <!-- end jd-content -->

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div> <!-- end footer -->
</div><!-- end doc-content -->

<!-- Start of Tag -->
<script type="text/javascript">
var axel = Math.random() + "";
var a = axel * 10000000000000;
document.write('<iframe src="https://2507573.fls.doubleclick.net/activityi;src=2507573;type=other026;cat=googl348;ord=' + a + '?" width="1" height="1" frameborder="0" style="display:none"></iframe>');
</script>
<noscript>
<iframe src="https://2507573.fls.doubleclick.net/activityi;src=2507573;type=other026;cat=googl348;ord=1?" width="1" height="1" frameborder="0" style="display:none"></iframe>
</noscript>
<!-- End of Tag -->


</div> <!-- end body-content --> 





  <script src="https://developer.android.com/ytblogger_lists_unified.js" type="text/javascript"></script>
  <script src="../../jd_lists_unified.js" type="text/javascript"></script>
  <script src="../../jd_extras.js" type="text/javascript"></script>
  <script src="../../jd_collections.js" type="text/javascript"></script>
  <script src="../../jd_tag_helpers.js" type="text/javascript"></script>

</body>
</html>



