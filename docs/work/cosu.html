<!DOCTYPE html>
























































































<html>
<head>

  

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
<link rel="alternate" href="http://developer.android.com/work/cosu.html" hreflang="en" />
<link rel="alternate" href="http://developer.android.com/intl/es/work/cosu.html" hreflang="es" />
<link rel="alternate" href="http://developer.android.com/intl/id/work/cosu.html" hreflang="id" />
<link rel="alternate" href="http://developer.android.com/intl/ja/work/cosu.html" hreflang="ja" />
<link rel="alternate" href="http://developer.android.com/intl/ko/work/cosu.html" hreflang="ko" />
<link rel="alternate" href="http://developer.android.com/intl/pt-br/work/cosu.html" hreflang="pt-br" />
<link rel="alternate" href="http://developer.android.com/intl/ru/work/cosu.html" hreflang="ru" />
<link rel="alternate" href="http://developer.android.com/intl/vi/work/cosu.html" hreflang="vi" />
<link rel="alternate" href="http://developer.android.com/intl/zh-cn/work/cosu.html" hreflang="zh-cn" />
<link rel="alternate" href="http://developer.android.com/intl/zh-tw/work/cosu.html" hreflang="zh-tw" />


<title>Set up Single-Purpose Devices | Android Developers
</title>

<meta name="description" content="Learn how to develop single-use solutions for Android devices.">

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="http://fonts.useso.com/css?family=Roboto+Condensed">
<link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto:light,regular,medium,thin,italic,mediumitalic,bold"
  title="roboto">

<link href="../assets/css/default.css?v=16" rel="stylesheet" type="text/css">

<!-- JAVASCRIPT -->
<script src="../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../";
  var metaTags = ["work","cosu"];
  var devsite = false;
  var useUpdatedTemplates = false;
</script>
<script src="../assets/js/docs.js?v=17" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//../ajax/www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5831155-1', 'android.com');
  ga('create', 'UA-49880327-2', 'android.com', {'name': 'universal'});  // New tracker);
  ga('send', 'pageview');
  ga('universal.send', 'pageview'); // Send page view for new tracker.
</script>

</head>

<body class="gc-documentation


" itemscope itemtype="http://schema.org/Article">
  
  <a name="top"></a>
  <!-- Header -->
  <div id="header-wrapper">
    <div class="dac-header " id="header">
      <div class="dac-header-inner">
        <a class="dac-nav-toggle" data-dac-toggle-nav href="javascript:;" title="Open navigation">
          <span class="dac-nav-hamburger">
            <span class="dac-nav-hamburger-top"></span>
            <span class="dac-nav-hamburger-mid"></span>
            <span class="dac-nav-hamburger-bot"></span>
          </span>
        </a>
        <a class="dac-header-logo" href="../index.html">
          <img class="dac-header-logo-image" src="../assets/images/android_logo.png"
              srcset="../assets/images/android_logo@2x.png 2x"
              width="32" height="36" alt="Android" /> Developers
          </a>

        <ul class="dac-header-tabs">
          <li>
          <a class="dac-header-tab" href="../design/index.html"
             zh-tw-lang="設計"
             zh-cn-lang="设计"
             ru-lang="Проектирование"
             ko-lang="디자인"
             ja-lang="設計"
             es-lang="Diseñar">Design</a>
          </li>
          <li>
          <a class="dac-header-tab" href="../develop/index.html"
             zh-tw-lang="開發"
             zh-cn-lang="开发"
             ru-lang="Разработка"
             ko-lang="개발"
             ja-lang="開発"
             es-lang="Desarrollar">Develop</a>
          </li>
          <li>
          <a class="dac-header-tab" href="../distribute/index.html"
             zh-tw-lang="發佈"
             zh-cn-lang="分发"
             ru-lang="Распространение"
             ko-lang="배포"
             ja-lang="配布"
             es-lang="Distribuir">Distribute</a>
          </li>
        </ul>

        <a class="dac-header-console-btn" href="https://play.google.com/apps/publish/">
          <span class="dac-sprite dac-google-play"></span>
          <span class="dac-visible-desktop-inline">Developer</span>
          Console
        </a>

        
        
        
  <form data-search class="dac-header-search">
    <button class="dac-header-search-close" data-search-close>
      <i class="dac-sprite dac-back-arrow"></i>
    </button>

    <div class="dac-header-search-inner">
      <i class="dac-sprite dac-search-white dac-header-search-icon"></i>
      <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q" class="dac-header-search-input" placeholder="Search" />
      <button class="dac-header-search-clear dac-hidden" data-search-clear>
        <i class="dac-sprite dac-close-black"></i>
      </button>
    </div>
  </form>

        
      </div><!-- end header-wrap.wrap -->
    </div><!-- end header -->
  </div> <!--end header-wrapper -->

  
  <!-- Navigation-->
  <nav class="dac-nav">
    <div class="dac-nav-dimmer" data-dac-toggle-nav></div>

    <div class="dac-nav-sidebar" data-swap data-dynamic="false" data-transition-speed="300" data-dac-nav>
      <div data-swap-container>
        
  
    <a class="dac-nav-back-button dac-swap-section dac-up dac-no-anim" data-swap-button href="javascript:;">
      <i class="dac-sprite dac-nav-back"></i> <span class="dac-nav-back-title">Back</span>
    </a>
    <div class="dac-nav-sub dac-swap-section dac-right dac-active" itemscope itemtype="http://schema.org/SiteNavigationElement">
      
        
  <!-- Fullscreen toggler -->
  <button data-fullscreen class="dac-nav-fullscreen">
    <i class="dac-sprite dac-fullscreen"></i>
  </button>

  <script>$('[data-fullscreen]').dacFullscreen();</script>
  <!-- End: Fullscreen toggler -->

  
    <div id="devdoc-nav">
      <div id="api-nav-header">
        <div id="api-level-toggle">
          <label for="apiLevelCheckbox" class="disabled"
                 title="Select your target API level to dim unavailable APIs">API level: </label>
          <div class="select-wrapper">
            <select id="apiLevelSelector">
              <!-- option elements added by buildApiLevelSelector() -->
            </select>
          </div>
        </div><!-- end toggle -->
        <div id="api-nav-title">Android APIs</div>
      </div><!-- end nav header -->
      <script>
        var SINCE_DATA = [  ];
        buildApiLevelSelector();
      </script>

      <div class="dac-reference-nav" data-reference-tree>
        <ul class="dac-reference-nav-list" data-reference-namespaces>
          
        </ul>

        
      </div>
    </div>
  

      
    </div>
  

        <ul id="dac-main-navigation" class="dac-nav-list dac-swap-section dac-left dac-no-anim">
        <li class="dac-nav-item home">
          <a class="dac-nav-link" href="../index.html">Home</a>
          <i class="dac-sprite dac-expand-more-black dac-nav-sub-slider"></i>
          <ul class="dac-nav-secondary about">
            <li class="dac-nav-item versions">
              <a class="dac-nav-link" href="../about/versions/marshmallow/index.html">Android</a>
            </li>
            <li class="dac-nav-item wear">
              <a class="dac-nav-link" href="../wear/index.html">Wear</a>
            </li>
            <li class="dac-nav-item tv">
              <a class="dac-nav-link" href="../tv/index.html">TV</a>
            </li>
            <li class="dac-nav-item auto">
              <a class="dac-nav-link" href="../auto/index.html">Auto</a>
            </li>
          </ul>
        </li>
        <li class="dac-nav-item design">
          <a class="dac-nav-link" href="../design/index.html"
             zh-tw-lang="設計"
             zh-cn-lang="设计"
             ru-lang="Проектирование"
             ko-lang="디자인"
             ja-lang="設計"
             es-lang="Diseñar">Design</a>
        </li>
        <li class="dac-nav-item develop">
          <a class="dac-nav-link" href="../develop/index.html"
             zh-tw-lang="開發"
             zh-cn-lang="开发"
             ru-lang="Разработка"
             ko-lang="개발"
             ja-lang="開発"
             es-lang="Desarrollar">Develop</a>
          <i class="dac-sprite dac-expand-more-black dac-nav-sub-slider"></i>
          <ul class="dac-nav-secondary develop">
            <li class="dac-nav-item training">
              <a class="dac-nav-link" href="../training/index.html"
                 zh-tw-lang="訓練課程"
                 zh-cn-lang="培训"
                 ru-lang="Курсы"
                 ko-lang="교육"
                 ja-lang="トレーニング"
                 es-lang="Capacitación">Training</a>
            </li>
            <li class="dac-nav-item guide">
              <a class="dac-nav-link" href="../guide/index.html"
                 zh-tw-lang="API 指南"
                 zh-cn-lang="API 指南"
                 ru-lang="Руководства по API"
                 ko-lang="API 가이드"
                 ja-lang="API ガイド"
                 es-lang="Guías de la API">API Guides</a>
            </li>
            <li class="dac-nav-item reference">
              <a class="dac-nav-link" href="../reference/packages.html"
                 zh-tw-lang="參考資源"
                 zh-cn-lang="参考"
                 ru-lang="Справочник"
                 ko-lang="참조문서"
                 ja-lang="リファレンス"
                 es-lang="Referencia">Reference</a>
            </li>
            <li class="dac-nav-item tools">
              <a class="dac-nav-link" href="../sdk/index.html"
                 zh-tw-lang="相關工具"
                 zh-cn-lang="工具"
                 ru-lang="Инструменты"
                 ko-lang="도구"
                 ja-lang="ツール"
                 es-lang="Herramientas">Tools</a></li>
            <li class="dac-nav-item google">
              <a class="dac-nav-link" href="../google/index.html">Google Services</a>
            </li>
            
          </ul>
        </li>
        <li class="dac-nav-item distribute">
          <a class="dac-nav-link" href="../distribute/googleplay/index.html"
             zh-tw-lang="發佈"
             zh-cn-lang="分发"
             ru-lang="Распространение"
             ko-lang="배포"
             ja-lang="配布"
             es-lang="Distribuir">Distribute</a>
          <i class="dac-sprite dac-expand-more-black dac-nav-sub-slider"></i>
          <ul class="dac-nav-secondary distribute">
            <li class="dac-nav-item googleplay">
              <a class="dac-nav-link" href="../distribute/googleplay/index.html">Google Play</a></li>
            <li class="dac-nav-item essentials">
              <a class="dac-nav-link" href="../distribute/essentials/index.html">Essentials</a></li>
            <li class="dac-nav-item users">
              <a class="dac-nav-link" href="../distribute/users/index.html">Get Users</a></li>
            <li class="dac-nav-item engage">
              <a class="dac-nav-link" href="../distribute/engage/index.html">Engage &amp; Retain</a></li>
            <li class="dac-nav-item monetize">
              <a class="dac-nav-link" href="../distribute/monetize/index.html">Earn</a>
            </li>
            <li class="dac-nav-item analyze">
              <a class="dac-nav-link" href="../distribute/analyze/index.html">Analyze</a>
            </li>
            <li class="dac-nav-item stories">
              <a class="dac-nav-link" href="../distribute/stories/index.html">Stories</a>
            </li>
          </ul>
        </li>
        <li class="dac-nav-item preview">
          <a class="dac-nav-link" href="../preview/index.html">Preview</a>
        </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- end navigation-->
  

<!-- Nav Setup -->
<script>$('[data-dac-nav]').dacNav();</script>



  
    
  <div class="wrap clearfix" id="body-content">

  

  
  <div id="search-results" class="dac-search-results">
    <div id="dac-search-results-history" class="dac-search-results-history">
      <div class="wrap dac-search-results-history-wrap">
        <div class="cols">
          <div class="col-1of2 col-tablet-1of2 col-mobile-1of1">
            <h2>Most visited</h2>
            <div class="resource-flow-layout" data-history-query="history:most/visited" data-maxresults="3" data-cardsizes="18x2"></div>
          </div>

          <div class="col-1of2 col-tablet-1of2 col-mobile-1of1">
            <h2>Recently visited</h2>
            <div class="resource-flow-layout cols" data-history-query="history:recent" data-allow-duplicates="true" data-maxresults="3" data-cardsizes="18x2"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="dac-search-results-content" class="dac-search-results-content">
      <div class="dac-search-results-metadata wrap">
        <div class="dac-search-results-for">
          <h2>Results for <span id="search-results-for"></span></h2>
        </div>

        <div id="dac-search-results-hero"></div>

        <div class="dac-search-results-hero cols">
          <div id="dac-search-results-reference" class="col-3of6 col-tablet-1of2 col-mobile-1of1">
            <div class="suggest-card reference no-display">
              <ul class="dac-search-results-reference">
              </ul>
            </div>
          </div>
          <div id="dac-custom-search-results"></div>
        </div>
      </div>

    </div>
  </div>





  
    
      
        <ul class="dac-header-crumbs">
          
        </ul>

        <!-- Breadcrumb Setup -->
        <p><script>$('.dac-nav-list').dacCurrentPage().dacCrumbs();</script></p>

        <h1 itemprop="name" >Set up Single-Purpose Devices</h1>
      
    
  


  

  
  <div id="jd-content">
    <div class="jd-descr" itemprop="articleBody">
    

    <div id="qv-wrapper">
  <div id="qv">
    <h2>In this document</h2>
    <ol>
      <li><a href="#locktask">How to use LockTask mode</a></li>
      <li><a href="#cosu-solutions">Build COSU solutions</a></li>
      <li><a href="#create-dpc">Create your own DPC app</a></li>
    </ol>
  </div>
</div>

<p>
As an IT administrator, you can configure Android 6.0 Marshmallow and later
devices as <em>corporate-owned, single-use (COSU)</em> devices. These are Android
devices used for a single purpose, such as digital signage, ticket printing,
point of sale, or inventory management. To use Android devices as COSU devices,
you need to develop Android apps that your customers can manage.
</p>

<p>
Your customers can configure COSU devices:
</p>
<ul>
<li>
To lock a single application to the screen, and hide the
<strong>Home</strong> and <strong>Recents</strong> buttons to prevent users
from escaping the app.
</li>

<li>
To allow multiple applications to appear on the screen, such as a library kiosk
with a catalog app and web browser.
</li>
</ul>

<h2 id="pinning">
App pinning vs. lock task mode
</h2>

<p>Android 5.0 Lollipop introduced two new ways to configure Android devices
for a single purpose:
</p>

<ul>
<li>
With app pinning, the device user can temporarily pin specific apps to the
screen.
</li>

<li>
With lock task mode, a user can’t escape the app and the Home and Recents
buttons are hidden. Additionally, lock task mode gives the IT administrator
a more robust way to manage COSU devices, as discussed below.
</li>
</ul>

<p>
This graphic compares the features of app pinning and lock task mode:
</p>

<img src="../images/work/cosu-pinning_vs_locktaskmode.png"
width="640" srcset="../images/work/cosu-pinning_vs_locktaskmode.png 1x,
../images/work/cosu-pinning_vs_locktaskmode_2x.png 2x" />

 <p class="img-caption">
   <strong>Figure 1.</strong> Comparing the features of app pinning in Lollipop
   vs. Lock task mode in Marshmallow and later
 </p>

<p>
In Lollipop, you can pin a single application to cover the full screen, but
only apps whitelisted by the device policy controller (DPC) can be locked.
</p>

<h2 id="locktask">
  How to use LockTask mode
</h2>

<p>
  To use LockTask mode, and the APIs that manage COSU devices, there must be
  a device owner application installed on the device. Device owners are a
  type of device policy controller (DPC) that manages the whole device. For
  more information about DPCs, see the
  <a class="external-link" href="https://developers.google.com/android/work/overview">EMM Developer’s Overview</a>.
</p>

<p>
If you’re creating a new COSU app, we recommend you develop it for
Marshmallow or later, which includes the following COSU features:
</p>

<ul>
<li>
Controls system updates
</li>

<li>
Sets status and menu bar visibility
</li>

<li>
Disables screen lock and sleep functions
</li>

<li>
Permits switching between apps while staying in lock task mode
</li>

<li>
Prevents restarting in safe mode
</li>
</ul>

<p class="note">
  <strong>Note:</strong> If you develop COSU features targeted for
  Marshmallow devices, your app can still be compatible with prior
  versions of Android.
</p>

<p>
Additional COSU management features launched with Marshmallow make it easier to
develop and deploy Android devices as a single-use device. If you want to
enforce server-side managed configurations or server-side profile policy controls,
you need to use an EMM or make your application a DPC. Follow the instructions
below as you create your application.
</p>

<h2 id="cosu-solutions">
  Build COSU solutions
</h2>

<p>
  There are two different ways to manage COSU devices:
</p>

<ul>
<li>
<strong>Use a third-party enterprise mobility management (EMM)
solution</strong>: Using an EMM, all you need to do is set up lock task mode.
For instructions, skip to the next section,
<a href="#emm-solutions">Solutions managed by a third-party EMM</a>.
</li>

<li>
<strong>Advanced setup—Create your own DPC app</strong>: This requires
more work and is intended for an advanced developer audience. With this
option, you’ll need to set up the device so that you can manage it, set
up APIs, and set up a DPC app and test it. For instructions, skip to
<a href="#create-dpc">Create your own DPC app</a>.
</li>
</ul>

<h2 id="emm-solutions">
Solutions managed by a third-party EMM
</h2>

<p>
In this section, you’ll need to do a small amount of development to
have your device work with a third-party EMM.
</p>

<h3 id="use-smartlocktask">
Using startLockTask()
</h3>

<p>
If you need to add COSU functionality to an existing app, make sure that
the customer’s EMM supports <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>.
</p>

<ul>
<li>
The device owner must include your app’s package(s) in
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setLockTaskPackages(android.content.ComponentName, java.lang.String[])">setLockTaskPackages</a></code></li>
<ul>
<li>
Sets the packages that can enter into lock task mode
</li>
<li>
Needs to be set by the EMM
</li>
<li>
You can call <code><a href="../reference/android/app/admin/DevicePolicyManager.html#isLockTaskPermitted(java.lang.String)">isLockTaskPermitted</a></code>
to verify that your package has been whitelisted by
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setLockTaskPackages(android.content.ComponentName, java.lang.String[])">setLockTaskPackages</a></code>.
</li>
</ul>

<li>
Your activity calls <code><a href="../reference/android/app/Activity.html#startLockTask()">startLockTask()</a></code>
</li>
<ul>
<li>
Requests to lock the user into the current task
</li>
<li>
Prevents launching other apps, settings, and the <strong>Home</strong>
button
</li>
</ul>

<li>
To exit, your activity must call <code><a href="../reference/android/app/Activity.html#stopLockTask()">stopLockTask()</a></code>
</li>
<ul>
<li>
Can only be called on an activity that’s previously called
 <code><a href="../reference/android/app/Activity.html#startLockTask()">startLockTask()</a></code>
</li>
<li>
Should be called when the app is user-facing between <code><a href="../reference/android/app/Activity.html#onResume()">onResume()</a></code>
and <code><a href="../reference/android/app/Activity.html#onPause()">onPause()</a></code>
</li>
</ul>
</ul>

<p>
Starting from Marshmallow, if your app is whitelisted by an EMM using <code><a href="../reference/android/app/admin/DevicePolicyManager.html#setLockTaskPackages(android.content.ComponentName, java.lang.String[])">setLockTaskPackages</a></code>,
your activities can automatically start lock task mode when the app is
launched.
</p>

<h3 id="locktaskmode-attribute">
Set the lockTaskMode attribute
</h3>

<p>
  The <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code> attribute allows you to define
  your app’s lock task mode behavior in the AndroidManifest.xml file:
</p>

<ul>
<li>
If you set <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code> to <code>if_whitelisted</code>,
you don’t need to call <code><a href="../reference/android/app/Activity.html#startLockTask()">startLockTask()</a></code>, and the
app automatically enters into lock task mode.
</li>

<li>
System apps and privileged apps can also set <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>
to always. This setting causes tasks (rooted at your activity) to always
launch into lock task mode. Non-privileged apps are treated as normal.
</li>

<li>
The default value of the <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code> attribute is
normal. When this attribute is set to normal, tasks don’t launch into
<code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>, unless <code><a href="../reference/android/app/Activity.html#startLockTask()">startLockTask()</a></code>
is called. To call <code><a href="../reference/android/app/Activity.html#startLockTask()">startLockTask()</a></code>,
applications still need to be whitelisted using
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setLockTaskPackages(android.content.ComponentName, java.lang.String[])">setLockTaskPackages</a></code>,
otherwise, the user sees a dialog to approve entering pinned mode.
</li>
</ul>

<p>To have your activity <em>automatically</em> enter <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>,
change the value of this attribute to <code>if_whitelisted</code>.
Doing so causes your app to behave in this manner:
</p>

<ul>
<li>
If your app isn’t whitelisted for <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>,
it behaves as normal.
</li>

<li>
If your app is a system or privileged app, and it’s whitelisted,
<code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code> automatically starts when the app is
launched.
</li>
</ul>

<p>
Example XML as follows:
</p>

 <pre>&lt;activity android:name=".MainActivity" android:lockTaskMode="if_whitelisted"&gt;</pre>

<p>
Given either of these options, you still need to create a mechanism for
calling <code><a href="../reference/android/app/Activity.html#stopLockTask()">stopLockTask()</a></code> so that users can
exit <code><a href="../reference/android/R.attr.html#lockTaskMode">lockTaskMode</a></code>.
</p>

<h2 id="create-dpc">
  Advanced setup—Create your own DPC app
</h2>

<p>
To manage applications in COSU, you need a DPC running as device
owner to set several policies on the device.
</p>

<p class="note">
<strong>Note:</strong> This setup is advanced, and requires
a thorough understanding of the EMM concepts described in the
<a class="external-link" href="https://developers.google.com/android/work/prov-devices#implementation_considerations_for_device_owner_mode">EMM developer overview</a>.
For more information about building a DPC, see
<a class="external-link"
href="https://developers.google.com/android/work/prov-devices">Provision Customer Devices</a>.
</p>

<p>
To create a DPC app that can manage COSU device configuration,
the DPC needs to:
</p>

<ol>
<li>
Provision the device into device owner mode. We recommend that
you support provisioning with near field communication (NFC) bump.
For more information, see
<a class="external-link" href="https://developers.google.com/android/work/prov-devices#nfc_method"
>Device Owner Provisioning via NFC</a>.
</li>

<li>
Use the following APIs:
<ul>
<li>
Keep devices from locking with the keyguard using
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setKeyguardDisabled(android.content.ComponentName, boolean)">setKeyguardDisabled()</a></code>
</li>

<li>
Disable the status bar using
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setStatusBarDisabled(android.content.ComponentName, boolean)">setStatusBarDisabled()</a></code>
</li>

<li>
Keep a device’s screen on while plugged in via
<code><a href="../reference/android/provider/Settings.Global.html#STAY_ON_WHILE_PLUGGED_IN">STAY_ON_WHILE_PLUGGED_IN</a></code>
</li>

<li>
Set default user restriction for managed configurations via
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#addUserRestriction(android.content.ComponentName, java.lang.String)">addUserRestriction()</a></code>
</li>

<li>
Set system update policies using
<code><a href="../reference/android/app/admin/DevicePolicyManager.html#setSystemUpdatePolicy(android.content.ComponentName, android.app.admin.SystemUpdatePolicy)">setSystemUpdatePolicy()</a></code>
</li>

<li>
Ensure your app is launched on reboot by setting it as the default launcher
</li>
</ul>
</li>
</ol>

<p>
Here’s an example of how to implement an activity that starts lock task mode
and implements the relevant COSU device management APIs:
</p>

<pre>
public class CosuActivity extends Activity {

    private ComponentName mAdminComponentName;
    private DevicePolicyManager mDevicePolicyManager;
    private PackageManager mPackageManager;
    private static final String Battery_PLUGGED_ANY = Integer.toString(
            BatteryManager.BATTERY_PLUGGED_AC |
            BatteryManager.BATTERY_PLUGGED_USB |
            BatteryManager.BATTERY_PLUGGED_WIRELESS);

    private static final String DONT_STAY_ON = "0";

    &#64;Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        mAdminComponentName = DeviceAdminReceiver.getComponentName(this);
        mDevicePolicyManager = (DevicePolicyManager) getSystemService(
                Context.DEVICE_POLICY_SERVICE);
        mPackageManager = getPackageManager();
        setDefaultCosuPolicies(true);
    }

    &#64;Override
    protected void onStart() {
        super.onStart();

        // start lock task mode if it's not already active
        ActivityManager am = (ActivityManager) getSystemService(
                Context.ACTIVITY_SERVICE);
        // ActivityManager.getLockTaskModeState api is not available in pre-M.
        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.M) {
            if (!am.isInLockTaskMode()) {
                startLockTask();
            }
        } else {
            if (am.getLockTaskModeState() ==
                    ActivityManager.LOCK_TASK_MODE_NONE) {
                startLockTask();
            }
        }
    }

    private void setDefaultCosuPolicies(boolean active) {
        // set user restrictions
        setUserRestriction(UserManager.DISALLOW_SAFE_BOOT, active);
        setUserRestriction(UserManager.DISALLOW_FACTORY_RESET, active);
        setUserRestriction(UserManager.DISALLOW_ADD_USER, active);
        setUserRestriction(UserManager.DISALLOW_MOUNT_PHYSICAL_MEDIA, active);
        setUserRestriction(UserManager.DISALLOW_ADJUST_VOLUME, active);

        // disable keyguard and status bar
        mDevicePolicyManager.setKeyguardDisabled(mAdminComponentName, active);
        mDevicePolicyManager.setStatusBarDisabled(mAdminComponentName, active);

        // enable STAY_ON_WHILE_PLUGGED_IN
        enableStayOnWhilePluggedIn(active);

        // set System Update policy

        if (active){
            mDevicePolicyManager.setSystemUpdatePolicy(mAdminComponentName,
                    SystemUpdatePolicy.createWindowedInstallPolicy(60,120));
        } else {
            DevicePolicyManager.setSystemUpdatePolicy(mAdminComponentName, null);
        }

        // set this Activity as a lock task package

        mDevicePolicyManager.setLockTaskPackages(mAdminComponentName,
                active ? new String[]{getPackageName()} : new String[]{});

        IntentFilter intentFilter = new IntentFilter(Intent.ACTION_MAIN);
        intentFilter.addCategory(Intent.CATEGORY_HOME);
        intentFilter.addCategory(Intent.CATEGORY_DEFAULT);

        if (active) {
            // set Cosu activity as home intent receiver so that it is started
            // on reboot
            mDevicePolicyManager.addPersistentPreferredActivity(
                    mAdminComponentName, intentFilter, new ComponentName(
                            getPackageName(), CosuActivity.class.getName()));
        } else {
            mDevicePolicyManager.clearPackagePersistentPreferredActivities(
                    mAdminComponentName, getPackageName());
        }
    }

    private void setUserRestriction(String restriction, boolean disallow) {
        if (disallow) {
            mDevicePolicyManager.addUserRestriction(mAdminComponentName,
                    restriction);
        } else {
            mDevicePolicyManager.clearUserRestriction(mAdminComponentName,
                    restriction);
        }
    }

    private void enableStayOnWhilePluggedIn(boolean enabled) {
        if (enabled) {
            mDevicePolicyManager.setGlobalSetting(
                    mAdminComponentName,
                    Settings.Global.STAY_ON_WHILE_PLUGGED_IN,
                    Battery_PLUGGED_ANY);
        } else {
            mDevicePolicyManager.setGlobalSetting(
                    mAdminComponentName,
                    Settings.Global.STAY_ON_WHILE_PLUGGED_IN, DONT_STAY_ON);
        }
    }

    // TODO: Implement the rest of the Activity
}
</pre>


<h2 id="testing-plan">
  Develop a test plan for COSU
</h2>

<p>
  If you’re planning to support a third-party EMM, develop an end-to-end
  testing plan utilizing the EMM’s app. We also provide testing resources,
  which you can use to create your own Test Device Policy Client (Test DPC):
</p>

<ul>
<li>
<a class="external-link" href="https://play.google.com/store/search?q=testdpc">TestDPC on Google Play</a>
</li>
<li>
<a class="external-link" href="https://github.com/googlesamples/android-testdpc/tree/master/app/src/main/java/com/afwsamples/testdpc/cosu">TestDPC for COSU source code on GitHub</a>
</li>
<li>
<a class="external-link" href="https://github.com/googlesamples/android-testdpc">Test Device Policy Control app source code on GitHub</a>
</li>
</ul>

    </div>

    

  </div> <!-- end jd-content -->



<div class="wrap">
  <div class="dac-footer">
    <div class="cols dac-footer-main">
      <div class="col-1of2">
        <a class="dac-footer-getnews" id="newsletter" data-modal-toggle="newsletter" href="javascript:;">Get news &amp; tips <span
          class="dac-fab dac-primary"><i class="dac-sprite dac-mail"></i></span></a>
      </div>
      <div class="col-1of2 dac-footer-reachout">
        <div class="dac-footer-contact">
          <a class="dac-footer-contact-link" href="http://android-developers.blogspot.com/">Blog</a>
          <a class="dac-footer-contact-link" href="../support.html">Support</a>
        </div>
        <div class="dac-footer-social">
          <a class="dac-button-social dac-youtube dac-footer-social-link" href="https://www.youtube.com/user/androiddevelopers"><i class="dac-sprite dac-youtube"></i></a>
          <a class="dac-button-social dac-gplus dac-footer-social-link" href="https://plus.google.com/+AndroidDevelopers"><i class="dac-sprite dac-gplus"></i></a>
          <a class="dac-button-social dac-twitter dac-footer-social-link" href="https://twitter.com/AndroidDev"><i class="dac-sprite dac-twitter"></i></a>
        </div>
      </div>
    </div>

    <hr class="dac-footer-separator"/>

    
      <p class="dac-footer-copyright">
        
  Except as noted, this content is
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and
  restrictions, see the <a href="../license.html">Content
  License</a>.

      </p>
    

    <p class="dac-footer-links">
      <a href="../about/android.html">About Android</a>
      <a href="../auto/index.html">Auto</a>
      <a href="../tv/index.html">TV</a>
      <a href="../wear/index.html">Wear</a>
      <a href="../legal.html">Legal</a>

      <span id="language" class="locales">
        <select name="language" onchange="changeLangPref(this.value, true)">
          <option value="en" selected="selected">English</option>
          <option value="es">Español</option>
          <option value="in">Bahasa Indonesia</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="pt-br">Português Brasileiro</option>
          <option value="ru">Русский</option>
          <option value="vi">tiếng Việt</option>
          <option value="zh-cn">中文（简体)</option>
          <option value="zh-tw">中文（繁體)</option>
        </select>
      </span>
    </p>
  </div>
</div>
<!-- end footer -->



  



<div data-modal="newsletter" data-newsletter data-swap class="dac-modal newsletter">
  <div class="dac-modal-container">
    <div class="dac-modal-window">
      <header class="dac-modal-header">
        <div class="dac-modal-header-actions">
          <button class="dac-modal-header-close" data-modal-toggle></button>
        </div>
        <div class="dac-swap" data-swap-container>
          <section class="dac-swap-section dac-active dac-down">
            <h2 class="norule dac-modal-header-title" data-t="newsletter.title"></h2>
            <p class="dac-modal-header-subtitle" data-t="newsletter.requiredHint"></p>
          </section>
          <section class="dac-swap-section dac-up">
            <h2 class="norule dac-modal-header-title" data-t="newsletter.successTitle">Hooray!</h2>
          </section>
        </div>
      </header>
      <div class="dac-swap" data-swap-container>
        <section class="dac-swap-section dac-active dac-left">
          <form action="https://docs.google.com/forms/d/1QgnkzbEJIDu9lMEea0mxqWrXUJu0oBCLD7ar23V0Yys/formResponse" class="dac-form" method="post" target="dac-newsletter-iframe">
            <input type="hidden" name="entry.935454734" data-newsletter-language>
            <section class="dac-modal-content">
              <fieldset class="dac-form-fieldset">
                <div class="cols">
                  <div class="col-1of2 newsletter-leftCol">
                    <div class="dac-form-input-group">
                      <label for="newsletter-full-name" class="dac-form-floatlabel" data-t="newsletter.name">Full name</label>
                      <input type="text" class="dac-form-input" name="entry.1357890476" id="newsletter-full-name" required>
                      <span class="dac-form-required">*</span>
                    </div>
                    <div class="dac-form-input-group">
                      <label for="newsletter-email" class="dac-form-floatlabel" data-t="newsletter.email">Email address</label>
                      <input type="email" class="dac-form-input" name="entry.472100832" id="newsletter-email" required>
                      <span class="dac-form-required">*</span>
                    </div>
                  </div>
                  <div class="col-1of2 newsletter-rightCol">
                    <div class="dac-form-input-group">
                      <label for="newsletter-company" class="dac-form-floatlabel" data-t="newsletter.company">Company / developer name</label>
                      <input type="text" class="dac-form-input" name="entry.1664780309" id="newsletter-company">
                    </div>
                    <div class="dac-form-input-group">
                      <label for="newsletter-play-store" class="dac-form-floatlabel" data-t="newsletter.appUrl">One of your Play Store app URLs</label>
                      <input type="url" class="dac-form-input" name="entry.47013838" id="newsletter-play-store" required>
                      <span class="dac-form-required">*</span>
                    </div>
                  </div>
                </div>
              </fieldset>
              <fieldset class="dac-form-fieldset">
                <div class="cols">
                  <div class="col-1of2 newsletter-leftCol">
                    <legend class="dac-form-legend"><span data-t="newsletter.business.label">Which best describes your business:</span><span class="dac-form-required">*</span>
                    </legend>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Apps" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-app" required>
                      <label for="newsletter-business-type-app" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-app" class="dac-form-label" data-t="newsletter.business.apps">Apps</label>
                    </div>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Games" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-games" required>
                      <label for="newsletter-business-type-games" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-games" class="dac-form-label" data-t="newsletter.business.games">Games</label>
                    </div>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Apps and Games" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-appsgames" required>
                      <label for="newsletter-business-type-appsgames" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-appsgames" class="dac-form-label" data-t="newsletter.business.both">Apps &amp; Games</label>
                    </div>
                  </div>
                  <div class="col-1of2 newsletter-rightCol newsletter-checkboxes">
                    <div class="dac-form-radio-group">
                      <div class="dac-media">
                        <div class="dac-media-figure">
                          <input type="checkbox" class="dac-form-checkbox" name="entry.732309842" id="newsletter-add" required value="Add me to the mailing list for the monthly newsletter and occasional emails about development and Google Play opportunities.">
                          <label for="newsletter-add" class="dac-form-checkbox-button"></label>
                        </div>
                        <div class="dac-media-body">
                          <label for="newsletter-add" class="dac-form-label dac-form-aside"><span data-t="newsletter.confirmMailingList"></span><span class="dac-form-required">*</span></label>
                        </div>
                      </div>
                    </div>
                    <div class="dac-form-radio-group">
                      <div class="dac-media">
                        <div class="dac-media-figure">
                          <input type="checkbox" class="dac-form-checkbox" name="entry.2045036090" id="newsletter-terms" required value="I acknowledge that the information provided in this form will be subject to Google's privacy policy (https://www.google.com/policies/privacy/).">
                          <label for="newsletter-terms" class="dac-form-checkbox-button"></label>
                        </div>
                        <div class="dac-media-body">
                          <label for="newsletter-terms" class="dac-form-label dac-form-aside"><span data-t="newsletter.privacyPolicy" data-t-html></span><span class="dac-form-required">*</span></label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </section>
            <footer class="dac-modal-footer">
              <div class="cols">
                <div class="col-2of5">
                </div>
              </div>
              <button type="submit" value="Submit" class="dac-fab dac-primary dac-large dac-modal-action"><i class="dac-sprite dac-arrow-right"></i></button>
            </footer>
          </form>
        </section>
        <section class="dac-swap-section dac-right">
          <div class="dac-modal-content">
            <p class="newsletter-success-message" data-t="newsletter.successDetails"></p>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
<!-- end newsletter modal -->

<!-- start reset language header modal -->
<div data-modal="langform" class="dac-modal" id="langform">
  <div class="dac-modal-container">
    <div class="dac-modal-window">
      <header class="dac-modal-header">
        <div class="dac-modal-header-actions">
          <button class="dac-modal-header-close" data-modal-toggle></button>
        </div>
        <section class="dac-swap-section dac-active dac-down">
          <h2 class="norule dac-modal-header-title"></h2>
        </section>
      </header>
      <section class="dac-swap-section dac-active dac-left">
          <section class="dac-modal-content">
            <fieldset class="dac-form-fieldset">
              <div class="cols">
                <div class="col-2of2 langform-leftCol">
                  <p id="resetLangText"></p>
                  <p id="resetLangCta"></p>
                </div>
              </div>
            </fieldset>
          </section>
          <footer class="dac-modal-footer" id="langfooter">
            <div class="cols">
              <div class="col-2of5">
              </div>
            </div>
              <button class="button dac-primary dac-modal-action lang yes" data-t="newsletter.resetLangButtonYes" data-modal-toggle></button>
              <button class="button dac-primary dac-modal-action lang no" data-t="newsletter.resetLangButtonNo" data-modal-toggle></button>
            </a>
          </footer>
        </form>
      </section>
    </div>
  </div>
</div>
<!-- end langreset modal -->


</div> <!-- end body-content --> 




<script src="../ajax/developer.android.com/ytblogger_lists_unified.js" defer></script>
<script src="/jd_lists_unified_en.js?v=17" defer></script>
<script src="/reference/lists.js?v=17" defer></script>
<script src="/reference/gcm_lists.js?v=17" defer></script>
<script src="/reference/gms_lists.js?v=17" defer></script>
<script>
  // Load localized metadata.
  (function(lang) {
    if (lang === 'en') { return; }

    // Write it to the document so it gets evaluated before DOMContentReady.
    document.write('<script src="/jd_lists_unified_' + lang + '.js?v=14" defer></' + 'script>');
  })(getLangPref())
</script>


</body>
</html>
