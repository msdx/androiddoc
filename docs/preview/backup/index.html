<!DOCTYPE html>





























































































<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta content="IE=edge" http-equiv="X-UA-Compatible">

<meta name="Description" content="Users often invest significant time and effort creating data and setting preferences within apps. Preserving that data for users if they replace a broken device or upgrade to a new one is an important part of ensuring a great user experience. Devices …">
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>Auto Backup for Apps | Android Developers</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="http://fonts.useso.com/css?family=Roboto+Condensed">
<link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto:light,regular,medium,thin,italic,mediumitalic,bold"
  title="roboto">

<link href="../../assets/css/default.css?v=7" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var metaTags = ["backup","previewresources","androidm"];
  var devsite = false;
</script>
<script src="../../assets/js/docs.js?v=6" type="text/javascript"></script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5831155-1', 'android.com');
  ga('create', 'UA-49880327-2', 'android.com', {'name': 'universal'});  // New tracker);
  ga('send', 'pageview');
  ga('universal.send', 'pageview'); // Send page view for new tracker.
</script>

</head>

<body class="gc-documentation


develop preview" itemscope itemtype="http://schema.org/Article">
<a name="top"></a>

<!-- dialog to prompt lang pref change when loaded from hardcoded URL
<div id="langMessage" style="display:none">
  <div>
    <div class="lang en">
      <p>You requested a page in English, would you like to proceed with this language setting?</p>
    </div>
    <div class="lang es">
      <p>You requested a page in Spanish (Español), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ja">
      <p>You requested a page in Japanese (日本語), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ko">
      <p>You requested a page in Korean (한국어), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ru">
      <p>You requested a page in Russian (Русский), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-cn">
      <p>You requested a page in Simplified Chinese (简体中文), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-tw">
      <p>You requested a page in Traditional Chinese (繁體中文), would you like to proceed with this language setting?</p>
    </div>
    <a href="#" class="button yes" onclick="return false;">
      <span class="lang en">Yes</span>
      <span class="lang es">Sí</span>
      <span class="lang ja">Yes</span>
      <span class="lang ko">Yes</span>
      <span class="lang ru">Yes</span>
      <span class="lang zh-cn">是的</span>
      <span class="lang zh-tw">没有</span>
    </a>
    <a href="#" class="button" onclick="$('#langMessage').hide();return false;">
      <span class="lang en">No</span>
      <span class="lang es">No</span>
      <span class="lang ja">No</span>
      <span class="lang ko">No</span>
      <span class="lang ru">No</span>
      <span class="lang zh-cn">没有</span>
      <span class="lang zh-tw">没有</span>
    </a>
  </div>
</div> -->


  <!-- Header -->
  <div id="header-wrapper">
    <div class="dac-header" id="header">




      <div class="dac-header-inner">
        <a class="dac-nav-toggle" data-dac-toggle-nav href="javascript:;" title="Open navigation">
          <span class="dac-nav-hamburger">
            <span class="dac-nav-hamburger-top"></span>
            <span class="dac-nav-hamburger-mid"></span>
            <span class="dac-nav-hamburger-bot"></span>
          </span>
        </a>
        <a class="dac-header-logo" href="../../index.html">
          <img class="dac-header-logo-image" src="../../assets/images/android_logo.png"
              srcset="../../assets/images/android_logo@2x.png 2x"
              width="32" height="36" alt="Android" /> Developers
          </a>

        <ul class="dac-header-crumbs">
          
          <li class="dac-header-crumbs-item"><span class="dac-header-crumbs-link current ">Auto Backup for Apps</a></li>
        </ul>

        
        
        
  <div class="dac-header-search" id="search-container">
    <div class="dac-header-search-inner">
      <div class="dac-sprite dac-search dac-header-search-btn" id="search-btn"></div>
      <form class="dac-header-search-form" onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
          onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
          onkeydown="return search_changed(event, true, '../../')"
          onkeyup="return search_changed(event, false, '../../')"
          class="dac-header-search-input" placeholder="Search" />
          <a class="dac-header-search-close hide" id="search-close">close</a>
      </form>
    </div><!-- end dac-header-search-inner -->
  </div><!-- end dac-header-search -->

  <div class="search_filtered_wrapper">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
      <div class="child-card samples no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

        

        <a class="dac-header-console-btn" href="https://play.google.com/apps/publish/">
          <span class="dac-sprite dac-google-play"></span>
          <span class="dac-visible-desktop-inline">Developer</span>
          Console
        </a>

      </div><!-- end header-wrap.wrap -->
    </div><!-- end header -->

    <div id="searchResults" class="wrap" style="display:none;">
      <h2 id="searchTitle">Results</h2>
      <div id="leftSearchControl" class="search-control">Loading...</div>
    </div>
  </div> <!--end header-wrapper -->

  
  <!-- Navigation-->
  <nav class="dac-nav">
    <div class="dac-nav-dimmer" data-dac-toggle-nav></div>

    <ul class="dac-nav-list" data-dac-nav>
      <li class="dac-nav-item dac-nav-head">
        <a class="dac-nav-link dac-nav-logo" data-dac-toggle-nav href="javascript:;" title="Close navigation">
          <img class="dac-logo-image" src="../../assets/images/android_logo.png"
               srcset="../../assets/images/android_logo@2x.png 2x"
               width="32" height="36" alt="Android" /> Developers
        </a>
      </li>
      <li class="dac-nav-item home">
        <a class="dac-nav-link dac-visible-mobile-block" href="../../index.html">Home</a>
        <ul class="dac-nav-secondary about">
          <li class="dac-nav-item about">
            <a class="dac-nav-link" href="../../about/index.html">Android</a>
          </li>
          <li class="dac-nav-item wear">
            <a class="dac-nav-link" href="../../wear/index.html">Wear</a>
          </li>
          <li class="dac-nav-item tv">
            <a class="dac-nav-link" href="../../tv/index.html">TV</a>
          </li>
          <li class="dac-nav-item auto">
            <a class="dac-nav-link" href="../../auto/index.html">Auto</a>
          </li>
        </ul>
      </li>
      <li class="dac-nav-item design">
        <a class="dac-nav-link" href="../../design/index.html"
           zh-tw-lang="設計"
           zh-cn-lang="设计"
           ru-lang="Проектирование"
           ko-lang="디자인"
           ja-lang="設計"
           es-lang="Diseñar">Design</a>
      </li>
      <li class="dac-nav-item develop">
        <a class="dac-nav-link" href="../../develop/index.html"
           zh-tw-lang="開發"
           zh-cn-lang="开发"
           ru-lang="Разработка"
           ko-lang="개발"
           ja-lang="開発"
           es-lang="Desarrollar">Develop</a>
        <ul class="dac-nav-secondary develop">
          <li class="dac-nav-item training">
            <a class="dac-nav-link" href="../../training/index.html"
               zh-tw-lang="訓練課程"
               zh-cn-lang="培训"
               ru-lang="Курсы"
               ko-lang="교육"
               ja-lang="トレーニング"
               es-lang="Capacitación">Training</a>
          </li>
          <li class="dac-nav-item guide">
            <a class="dac-nav-link" href="../../guide/index.html"
               zh-tw-lang="API 指南"
               zh-cn-lang="API 指南"
               ru-lang="Руководства по API"
               ko-lang="API 가이드"
               ja-lang="API ガイド"
               es-lang="Guías de la API">API Guides</a>
          </li>
          <li class="dac-nav-item reference">
            <a class="dac-nav-link" href="../../reference/packages.html"
               zh-tw-lang="參考資源"
               zh-cn-lang="参考"
               ru-lang="Справочник"
               ko-lang="참조문서"
               ja-lang="リファレンス"
               es-lang="Referencia">Reference</a>
          </li>
          <li class="dac-nav-item tools">
            <a class="dac-nav-link" href="../../sdk/index.html"
               zh-tw-lang="相關工具"
               zh-cn-lang="工具"
               ru-lang="Инструменты"
               ko-lang="도구"
               ja-lang="ツール"
               es-lang="Herramientas">Tools</a></li>
          <li class="dac-nav-item google">
            <a class="dac-nav-link" href="../../google/index.html">Google Services</a>
          </li>
          
          <li class="dac-nav-item preview">
            <a class="dac-nav-link" href="../../preview/index.html">Preview</a>
          </li>
        </ul>
      </li>
      <li class="dac-nav-item distribute">
        <a class="dac-nav-link" href="../../distribute/googleplay/index.html"
           zh-tw-lang="發佈"
           zh-cn-lang="分发"
           ru-lang="Распространение"
           ko-lang="배포"
           ja-lang="配布"
           es-lang="Distribuir">Distribute</a>
        <ul class="dac-nav-secondary distribute">
          <li class="dac-nav-item googleplay">
            <a class="dac-nav-link" href="../../distribute/googleplay/index.html">Google Play</a></li>
          <li class="dac-nav-item essentials">
            <a class="dac-nav-link" href="../../distribute/essentials/index.html">Essentials</a></li>
          <li class="dac-nav-item users">
            <a class="dac-nav-link" href="../../distribute/users/index.html">Get Users</a></li>
          <li class="dac-nav-item engage">
            <a class="dac-nav-link" href="../../distribute/engage/index.html">Engage &amp; Retain</a></li>
          <li class="dac-nav-item monetize">
            <a class="dac-nav-link" href="../../distribute/monetize/index.html">Earn</a>
          </li>
          <li class="dac-nav-item analyze">
            <a class="dac-nav-link" href="../../distribute/analyze/index.html">Analyze</a>
          </li>
          <li class="dac-nav-item stories">
            <a class="dac-nav-link" href="../../distribute/stories/index.html">Stories</a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>
  <!-- end navigation-->
  




  <div class="wrap clearfix" id="body-content"><div class="cols">
    <div class="col-4 dac-toggle dac-mobile" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      
  <div class="dac-visible-mobile-block" data-toggle="section">
    <span class="dac-toggle-expand dac-devdoc-toggle"><i class="dac-sprite dac-expand-more-black"></i> Show navigation</span>
    <span class="dac-toggle-collapse dac-devdoc-toggle" data-toggle-section><i class="dac-sprite dac-expand-less-black"></i> Hide navigation</span>
  </div>

      <div class="dac-toggle-content" id="devdoc-nav">
        <div class="scroll-pane">
<ul id="nav">

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/overview.html"
   es-lang="Información general del programa"
   ja-lang="プログラム概要"
   ko-lang="프로그램 개요"
   pt-br-lang="Visão geral do programa"
   ru-lang="Обзор программы"
   zh-cn-lang="计划概览"
   zh-tw-lang="程式總覽">
   Program Overview</a></div>
  </li>


  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/download.html"
      es-lang="Descargas"
      ja-lang="ダウンロード"
      ko-lang="다운로드"
      pt-br-lang="Downloads"
      ru-lang="Загрузки"
      zh-cn-lang="下载"
      zh-tw-lang="下載">
      Downloads</a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/setup-sdk.html"
      es-lang="Configurar el SDK de la versión preliminar"
      ja-lang="Preview SDK のセットアップ"
      ko-lang="미리 보기 SDK 설정하기"
      pt-br-lang="Configuração do Preview SDK"
      ru-lang="Настройка пакета SDK Preview"
      zh-cn-lang="设置预览版 SDK"
      zh-tw-lang="設定預覽版 SDK">
      Set up the SDK</a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../preview/testing/guide.html"
      es-lang="Guía de prueba"
      ja-lang="テストガイド"
      ko-lang="테스트 가이드"
      pt-br-lang="Guia de teste"
      ru-lang="Руководство по тестированию"
      zh-cn-lang="测试指南"
      zh-tw-lang="測試指南">
      Testing Guide</a></div>
      <ul>
        <li><a href="../../preview/testing/performance.html"
      es-lang="Prueba de rendimiento de video"
      ja-lang="表示パフォーマンスのテスト"
      ko-lang="표시 성능 테스트"
      pt-br-lang="Teste de desempenho de exibição"
      ru-lang="Тестирование скорости отображения"
      zh-cn-lang="测试显示性能"
      zh-tw-lang="測試顯示效能">
      Performance Testing</a></li>
      </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../preview/api-overview.html"
      es-lang="Información general de la API"
      ja-lang="API の概要"
      ko-lang="API 개요"
      pt-br-lang="Visão geral da API"
      ru-lang="Обзор API-интерфейсов"
      zh-cn-lang="API 概览"
      zh-tw-lang="API 總覽">API Overview
      </a></div>
      <ul>
        <li><a href="../../preview/features/runtime-permissions.html"
      es-lang="Permisos"
      ja-lang="パーミッション"
      ko-lang="권한"
      pt-br-lang="Permissões"
      ru-lang="Разрешения"
      zh-cn-lang="权限"
      zh-tw-lang="權限">Permissions
          </a></li>
        <li><a href="../../preview/features/app-linking.html"
      es-lang="Vínculos de la aplicación"
      ja-lang="App Links"
      ko-lang="앱 링크"
      pt-br-lang="Links de aplicativos"
      ru-lang="Связи приложений"
      zh-cn-lang="应用链接"
      zh-tw-lang="應用程式連結">
      App Links</a></li>
        <li><a href="../../preview/backup/index.html"
      es-lang="Copia de seguridad automática para aplicaciones"
      ja-lang="アプリの自動バックアップ"
      ko-lang="앱용 자동 백업"
      pt-br-lang="Backup automático para aplicativos"
      ru-lang="Автоматическое резервное копирование для приложений"
      zh-cn-lang="自动备份应用"
      zh-tw-lang="針對應用程式進行自動備份">
          Auto Backup for Apps</a></li>
      </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/behavior-changes.html"
      es-lang="Cambios en los comportamientos"
      ja-lang="動作の変更点"
      ko-lang="동작 변경"
      pt-br-lang="Mudanças de comportamento"
      ru-lang="Изменения в работе"
      zh-cn-lang="行为变更"
      zh-tw-lang="行為變更">Behavior Changes
       </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/samples.html"
      es-lang="Ejemplos"
      ja-lang="サンプル"
      ko-lang="샘플"
      pt-br-lang="Exemplos"
      ru-lang="Примеры"
      zh-cn-lang="示例"
      zh-tw-lang="範例">
      Samples</a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/support.html">
      Support & Release Notes</a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../preview/license.html"
      es-lang="Contrato de licencia"
      ja-lang="使用許諾契約"
      ko-lang="라이선스 계약"
      pt-br-lang="Contrato de licença"
      ru-lang="Лицензионное соглашение"
      zh-cn-lang="许可协议"
      zh-tw-lang="授權協議">
      License Agreement</a></div>
  </li>

</ul>

        </div>
      </div>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  

  
    
      
        <h1 itemprop="name" >Auto Backup for Apps</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
  <div id="qv">
    <h2>In this document</h2>
      <ol>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#configuring">Configuring Data Backup</a></li>
        <li><a href="#testing">Testing Backup Configuration</a></li>
        <li><a href="#issues">Known Issues</a></li>
      </ol>
  </div>
</div>

<p>
  Users often invest significant time and effort creating data and setting preferences within
  apps. Preserving that data for users if they replace a broken device or upgrade to a new one is
  an important part of ensuring a great user experience. Devices running the Android M Preview
  system help ensure a good experience for users in these circumstances by automatically backing up
  app data to Google Drive. The app data is automatically restored if a user changes or upgrades a
  device.
</p>

<p>
  Automatic backups are enabled for all apps installed on devices running the Android M Preview. No
  additional app code is required. The system provides users with the ability to opt out of
  automatic data backups. You can also choose to limit what data from your app is backed up.
</p>

<p>
  This document describes the new system behavior and how to specify what data is backed up for
  your app.
</p>

<h2 id="overview">Overview</h2>

<p>
  The automatic backup feature preserves the data your app creates on a user device by uploading it
  to the user’s Google Drive account and encrypting it. There is no charge to you or the user for
  data storage and the saved data does not count towards the user's personal Drive quota. During
  the M Preview period, users can store up to 25MB per Android app.
</p>

<p>
  Automatic backups occur every 24 hours, when the device is idle, charging, and connected to a
  Wi-Fi network. When these conditions are met, the Backup Manager service uploads all available
  backup data to the cloud. When the user transitions to a new device, or uninstalls and reinstalls
  the backed up app, a restore operation copies the backed up data into the newly installed
  app’s data directory.
</p>

<p class="note">
  <strong>Note:</strong> If your app uses the legacy
  <a href="../../google/backup/index.html">Android Backup service</a>, this new behavior
  does not apply and the existing backup behavior works as usual.
</p>


<h3 id="auto-exclude">Automatically Excluded Data Files</h3>

<p>
  Not all app data should be backed up, such as temporary files and caches, so the automatic backup
  service excludes certain data files by default:
</p>

<ul>
  <li>Files in the directories referred to by the <code><a href="../../reference/android/content/Context.html#getCacheDir()">getCacheDir()</a></code> and <code><a href="../../reference/android/content/ContextWrapper.html#getCodeCacheDir()">getCodeCacheDir()</a></code>
    methods.
  </li>

  <li>Files located on external storage, unless they reside in the directory referred to by the
    <code><a href="../../reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code>
  method.
  </li>

  <li>Files located in the directory referred to by the
    <code><a href="../../reference/android/content/Context.html#getNoBackupFilesDir()">getNoBackupFilesDir()</a></code> method.
  </li>
</ul>

<h2 id="configuring">Configuring Data Backup</h2>

<p>
  The data created by any app installed on an M Preview device is backed up, except for the
  automatically excluded files listed in the previous section. You can further limit and configure
  what data gets backed up from your app using settings in your app manifest.
</p>

<h3 id="include-exclude">Including or Excluding Data</h3>

<p>
  Depending on what data your app needs and how you save it, you may need to set specific
  rules for including or excluding certain files or directories. The automatic backup service
  supports setting these backup rules through use of an XML configuration file and the app
  manifest. In the app manifest, you can specify a backup scheme configuration file as shown in the
  following example:
</p>

<pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        package="com.my.appexample"&gt;
    &lt;uses-sdk android:minSdkVersion="MNC"/&gt;
    &lt;uses-sdk android:targetSdkVersion="MNC"/&gt;
    &lt;app ...
<strong>        android:fullBackupContent="&#64;xml/mybackupscheme"&gt;</strong>
    &lt;/app&gt;
    ...
&lt;/manifest&gt;
</pre>

<p>
  In this example code, the <code>android:fullBackupContent</code> attribute specifies an XML file,
  located in the <code>res/xml/</code> directory of your app development project, named
  <code>mybackupscheme.xml</code>. This configuration file includes rules for what files are backed
  up. The following example code shows a configuration file that excludes a specific file from
  backups:
</p>

<pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;full-backup-content&gt;
    &lt;exclude domain="database" path="device_info.db"/&gt;
&lt;/full-backup-content&gt;
</pre>

<p>
  This example backup configuration only excludes a specific database file from being backed up.
  All other files are backed up.
</p>

<h4>Backup Configuration Syntax</h4>

<p>
  The backup service configuration allows you to specify what files to include or exclude from
  backup. The syntax for the data backup configuration xml file is as follows:
</p>

<pre>
&lt;full-backup-content&gt;
    &lt;include domain=["file" | "database" | "sharedpref" | "external" | "root"] path="string" /&gt;
    &lt;exclude domain=["file" | "database" | "sharedpref" | "external" | "root"] path="string" /&gt;
&lt;/full-backup-content&gt;
</pre>

<p>
  The following elements and attributes allow you to specify the files to include and exclude from
  backup:
</p>

<ul>
  <li>
  <code>&lt;include&gt;</code>. Use this element if you want to specify a set of resources to
  back up, instead of having the system back up all data in your app by default. When you specify
  an <code>&lt;include&gt;</code> tag, the system backs up <em>only the resources specified</em>
  with this element.
  </li>

  <li>
  <code>&lt;exclude&gt;</code>. Use this element to specify a set of resources to exclude from
  backup. The system backs up all data in your app, except for resources specified with this
  element.
  </li>

  <li>
  <code>domain.</code> The type of resource you want to include or exclude from backup. The valid
  values you can specify for this attribute include:
  </li>

  <li style="list-style: none">
  <ul>
    <li>
    <code>root</code>. Specifies that the resource is in the app’s root directory.
    </li>

    <li>
    <code>file</code>. Corresponds to a resource in the directory returned by the
    <code><a href="../../reference/android/content/Context.html#getFilesDir()">getFilesDir()</a></code> method.
    </li>

    <li>
    <code>database</code>. Corresponds to a database returned by the
    <code><a href="../../reference/android/content/Context.html#getDatabasePath(java.lang.String)">getDatabasePath()</a></code> method or by using the
    <code><a href="../../reference/android/database/sqlite/SQLiteOpenHelper.html">SQLiteOpenHelper</a></code> class.
    </li>

    <li>
    <code>sharedpref</code>. Corresponds to a <code><a href="../../reference/android/content/SharedPreferences.html">SharedPreferences</a></code> object
    returned by the <code><a href="../../reference/android/content/Context.html#getSharedPreferences(java.lang.String, int)">getSharedPreferences()</a></code>
    method.
    </li>

    <li>
    <code>external</code>. Specifies that the resource is in external storage, and corresponds
    to a file in the directory returned by the
    <code><a href="../../reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a></code> method.
    </li>

    <li>
    <code>path</code>. The file path to a resource that you want to include or exclude from
    backup.
    </li>
  </ul>
  </li>
</ul>


<h3 id="prohibit">Prohibiting Data Backups</h3>

<p>
  You can choose to prevent automatic backups of any of your app data by setting the
  <code>android:allowBackup</code> attribute to <code>false</code> in the app element of
  your manifest. This setting is illustrated in the following example code:
</p>

<pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        package="com.my.appexample"&gt;
    &lt;uses-sdk android:minSdkVersion="MNC"/&gt;
    &lt;uses-sdk android:targetSdkVersion="MNC"/&gt;
    &lt;app ...
<strong>        android:allowBackup="false"&gt;</strong>
    &lt;/app&gt;
    ...
&lt;/manifest&gt;
</pre>


<h2 id="testing">Testing Backup Configuration</h2>

<p>
  Once you have created a backup configuration, you should test it to make sure your app saves data
  and can be restored properly.
</p>


<h4>Enabling Backup Logging</h4>

<p>
  To help determine how the backup feature is parsing your XML file, enable logging before
  performing a test backup:
</p>

<pre class="noprettyprint">
$ adb shell setprop log.tag.BackupXmlParserLogging VERBOSE
</pre>

<h4>Testing Backup</h4>

<p>To manually run a backup, first you must initialize the Backup Manager by calling the following
  command:
</p>

<pre class="noprettyprint">
$ adb shell bmgr run
</pre>

<p>
  Next, you manually backup your application using the following command, specifying the package
  name for your app as the <code>&lt;PACKAGE&gt;</code> parameter:
</p>

<pre class="noprettyprint">
$ adb shell bmgr fullbackup &lt;PACKAGE&gt;</pre>


<h4>Testing Restore</h4>

<p>
  To manually initiate a restore after your app data is backed up, call the following command,
  specifying the package name for your app as the <code>&lt;PACKAGE&gt;</code> parameter:
</p>

<pre class="noprettyprint">
$ adb shell bmgr restore &lt;PACKAGE&gt;
</pre>

<p class="warning">
  <b>Warning:</b> This action stops your app and wipes its data before performing the restore
  operation.
</p>

<p>
  You initiate the restore process for your app by uninstalling and reinstalling your app. The app
  data is automatically restored from the cloud once the app installation is complete.
</p>


<h4>Troubleshooting Backups</h4>

<p>
  If you run into issues, you can clear the backup data and associated metadata by turning backup
  off and on in the <strong>Settings &gt; Backup</strong>, factory resetting the device, or by
  calling this command:
</p>

<pre>$ adb shell bmgr wipe &lt;TRANSPORT&gt; &lt;PACKAGE&gt;</pre>

<p>
  The <code>&lt;TRANSPORT&gt;</code> value must be prefixed by <code>com.google.android.gms</code>.
  To get the list of transports, call the following command:
</p>

<pre>$ adb shell bmgr list transports</pre>

<h2 id="issues">Known Issues</h2>

<p>The following are known issues with the automatic backup service:</p>

<ul>
  <li><strong>Google Cloud Messaging</strong> -
  For apps that use Google Cloud Messaging for push notifications, there is a known issue where
  backing up the registration ID returned by Google Cloud Messaging registration can break push
  notifications for the restored app. It is important to query the API for a new
  registration ID after being installed on a new device, which is not be the case if the old
  registration ID was backed up. To avoid this, exclude the registration id from the set of backed
  up files.
  </li>
</ul>

    </div>

    

  </div> <!-- end jd-content -->

<div class="wrap">
  <div class="dac-footer">
    <div class="cols dac-footer-main">
      <div class="col-1of2">
        <a class="dac-footer-getnews" data-modal-toggle="newsletter" href="javascript:;">Get news &amp; tips <span
          class="dac-fab dac-primary"><i class="dac-sprite dac-mail"></i></span></a>
      </div>
      <div class="col-1of2 dac-footer-reachout">
        <div class="dac-footer-contact">
          <a class="dac-footer-contact-link" href="http://android-developers.blogspot.com/">Blog</a>
          <a class="dac-footer-contact-link" href="../../support.html">Support</a>
        </div>
        <div class="dac-footer-social">
          <a class="dac-fab dac-footer-social-link" href="https://www.youtube.com/user/androiddevelopers"><i class="dac-sprite dac-youtube"></i></a>
          <a class="dac-fab dac-footer-social-link" href="https://plus.google.com/+AndroidDevelopers"><i class="dac-sprite dac-gplus"></i></a>
          <a class="dac-fab dac-footer-social-link" href="https://twitter.com/AndroidDev"><i class="dac-sprite dac-twitter"></i></a>
        </div>
      </div>
    </div>

    <hr class="dac-footer-separator"/>

    
      <p class="dac-footer-copyright">
        
  Except as noted, this content is
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and
  restrictions, see the <a href="../../license.html">Content
  License</a>.
      </p>
    

    <p class="dac-footer-links">
      <a href="../../about/index.html">About Android</a>
      <a href="../../auto/index.html">Auto</a>
      <a href="../../tv/index.html">TV</a>
      <a href="../../wear/index.html">Wear</a>
      <a href="../../legal.html">Legal</a>

      <span id="language" class="locales">
        <select name="language" onchange="changeLangPref(this.value, true)">
          <option value="en" selected="selected">English</option>
          <option value="es">Español</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="pt-br">Português Brasileiro</option>
          <option value="ru">Русский</option>
          <option value="zh-cn">中文（简体)</option>
          <option value="zh-tw">中文（繁體)</option>
        </select>
      </span>
    </p>
  </div>
</div> <!-- end footer -->

<div data-modal="newsletter" data-newsletter data-swap class="dac-modal newsletter">
  <div class="dac-modal-container">
    <div class="dac-modal-window">
      <header class="dac-modal-header">
        <button class="dac-modal-header-close" data-modal-toggle><i class="dac-sprite dac-close"></i></button>
        <div class="dac-swap" data-swap-container>
          <section class="dac-swap-section dac-active dac-down">
            <h2 class="norule dac-modal-header-title">Get the latest Android developer news and tips that will help you find success on Google Play.</h2>
            <p class="dac-modal-header-subtitle">&#42; Required Fields</p>
          </section>
          <section class="dac-swap-section dac-up">
            <h2 class="norule dac-modal-header-title">Hooray!</h2>
          </section>
        </div>
      </header>
      <div class="dac-swap" data-swap-container>
        <section class="dac-swap-section dac-active dac-left">
          <form action="https://docs.google.com/forms/d/1QgnkzbEJIDu9lMEea0mxqWrXUJu0oBCLD7ar23V0Yys/formResponse" class="dac-form" method="post" target="dac-newsletter-iframe">
            <section class="dac-modal-content">
              <fieldset class="dac-form-fieldset">
                <div class="cols">
                  <div class="col-1of2 newsletter-leftCol">
                    <div class="dac-form-input-group">
                      <label for="newsletter-full-name" class="dac-form-floatlabel">Full name</label>
                      <input type="text" class="dac-form-input" name="entry.1357890476" id="newsletter-full-name" required>
                      <span class="dac-form-required">*</span>
                    </div>
                    <div class="dac-form-input-group">
                      <label for="newsletter-email" class="dac-form-floatlabel">Email address</label>
                      <input type="email" class="dac-form-input" name="entry.472100832" id="newsletter-email" required>
                      <span class="dac-form-required">*</span>
                    </div>
                  </div>
                  <div class="col-1of2 newsletter-rightCol">
                    <div class="dac-form-input-group">
                      <label for="newsletter-company" class="dac-form-floatlabel">Company / developer name</label>
                      <input type="text" class="dac-form-input" name="entry.1664780309" id="newsletter-company">
                    </div>
                    <div class="dac-form-input-group">
                      <label for="newsletter-play-store" class="dac-form-floatlabel">One of your Play Store app URLs</label>
                      <input type="url" class="dac-form-input" name="entry.47013838" id="newsletter-play-store" required>
                      <span class="dac-form-required">*</span>
                    </div>
                  </div>
                </div>
              </fieldset>
              <fieldset class="dac-form-fieldset">
                <div class="cols">
                  <div class="col-1of2 newsletter-leftCol">
                    <legend class="dac-form-legend">Which best describes your business:<span class="dac-form-required">*</span>
                    </legend>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Apps" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-app" required>
                      <label for="newsletter-business-type-app" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-app" class="dac-form-label">Apps</label>
                    </div>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Games" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-games" required>
                      <label for="newsletter-business-type-games" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-games" class="dac-form-label">Games</label>
                    </div>
                    <div class="dac-form-radio-group">
                      <input type="radio" value="Apps and Games" class="dac-form-radio" name="entry.1796324055" id="newsletter-business-type-appsgames" required>
                      <label for="newsletter-business-type-appsgames" class="dac-form-radio-button"></label>
                      <label for="newsletter-business-type-appsgames" class="dac-form-label">Apps &amp; Games</label>
                    </div>
                  </div>
                  <div class="col-1of2 newsletter-rightCol newsletter-checkboxes">
                    <div class="dac-form-radio-group">
                      <div class="dac-media">
                        <div class="dac-media-figure">
                          <input type="checkbox" class="dac-form-checkbox" name="entry.732309842" id="newsletter-add" required value="Add me to the mailing list for the monthly newsletter and occasional emails about development and Google Play opportunities.">
                          <label for="newsletter-add" class="dac-form-checkbox-button"></label>
                        </div>
                        <div class="dac-media-body">
                          <label for="newsletter-add" class="dac-form-label dac-form-aside">Add me to the mailing list for the monthly newsletter and occasional emails about development and Google Play opportunities.<span class="dac-form-required">*</span></label>
                        </div>
                      </div>
                    </div>
                    <div class="dac-form-radio-group">
                      <div class="dac-media">
                        <div class="dac-media-figure">
                          <input type="checkbox" class="dac-form-checkbox" name="entry.2045036090" id="newsletter-terms" required value="I acknowledge that the information provided in this form will be subject to Google's privacy policy (https://www.google.com/policies/privacy/).">
                          <label for="newsletter-terms" class="dac-form-checkbox-button"></label>
                        </div>
                        <div class="dac-media-body">
                          <label for="newsletter-terms" class="dac-form-label dac-form-aside">I acknowledge that the information provided in this form will be subject to <a href="https://www.google.com/policies/privacy/">Google's privacy policy</a>.<span class="dac-form-required">*</span></label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </section>
            <footer class="dac-modal-footer">
              <div class="cols">
                <div class="col-2of5">
                </div>
              </div>
              <button type="submit" value="Submit" class="dac-fab dac-primary dac-large dac-modal-action"><i class="dac-sprite dac-arrow-right"></i></button>
            </footer>
          </form>
        </section>
        <section class="dac-swap-section dac-right">
          <div class="dac-modal-content">
            <p class="newsletter-success-message">
              You have successfully signed up for the latest Android developer news and tips.
            </p>
          </div>
        </section>
      </div>
    </div>
  </div>
</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end .cols --> 
</div> <!-- end body-content --> 





  <script src="../../ajax/developer.android.com/ytblogger_lists_unified.js" type="text/javascript"></script>
  <script src="../../jd_lists_unified.js?v=15" type="text/javascript"></script>
  <script src="../../jd_extras.js?v=15" type="text/javascript"></script>
  <script src="../../jd_collections.js?v=15" type="text/javascript"></script>
  <script src="../../jd_tag_helpers.js?v=15" type="text/javascript"></script>

</body>
</html>
